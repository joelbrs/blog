<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://joelbrs.github.io/en-US/blog</id>
    <title>Joel's Blog Blog</title>
    <updated>2024-09-17T12:35:51.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://joelbrs.github.io/en-US/blog"/>
    <subtitle>Joel's Blog Blog</subtitle>
    <icon>http://joelbrs.github.io/en-US/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Guia de Introdução ao Docker]]></title>
        <id>http://joelbrs.github.io/en-US/blog/guia-introducao-docker</id>
        <link href="http://joelbrs.github.io/en-US/blog/guia-introducao-docker"/>
        <updated>2024-09-17T12:35:51.000Z</updated>
        <summary type="html"><![CDATA[Quando falamos de Docker, uma das primeiras coisas que nos vem à mente são containers. Basicamente, quase tudo em Docker se resume a containers, então, é super importante que você tenha esse conceito bem sólido na sua mente e não só isso, mas também como funcionam.]]></summary>
        <content type="html"><![CDATA[<p>Quando falamos de <em>Docker</em>, uma das primeiras coisas que nos vem à mente são <em>containers</em>. Basicamente, quase tudo em Docker se resume a containers, então, é super importante que você tenha esse conceito bem sólido na sua mente e não só isso, mas também como funcionam.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="como-funcionam-os-containers">Como funcionam os containers?<a class="hash-link" aria-label="Direct link to Como funcionam os containers?" title="Direct link to Como funcionam os containers?" href="http://joelbrs.github.io/en-US/blog/guia-introducao-docker#como-funcionam-os-containers">​</a></h2>
<p>Para explicar o conceito de containers, podemos começar pelo sistema operacional (SO) - tendo como base para a explicação o Linux, especificamente - ser composto de processos e subprocessos. Para entender melhor esse conceito, precisamos entender os três principais pilares que os sustentam: <em>Namespaces</em>, _CGroups _e <em>Overlay File System</em> (OFS) que falaremos a seguir.</p>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="namespaces">Namespaces:<a class="hash-link" aria-label="Direct link to Namespaces:" title="Direct link to Namespaces:" href="http://joelbrs.github.io/en-US/blog/guia-introducao-docker#namespaces">​</a></h3>
<p>A partir desses processos, surgiu os chamados <em>Namespaces</em>, que, basicamente, atuam no <strong>isolamento</strong> de cada processo. Nesse caso, há uma hierarquia entre os processos-pai e os processos-filhos, onde estes últimos são altamente dependentes dos primeiros e, caso aconteça algo aos processos principais, todo o meu sistema operacional vai à baixo. Tendo isso em mente, os Namespaces isolam cada processo do SO, permitindo que cada um rode de forma independente. Em outras palavras, um container emula um SO com processos rodando em isolamento e executando tarefas diferentes. Containers não executam um SO completo, mas apenas os elementos específicos necessários, incluindo o kernel.</p>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="cgroups">CGroups:<a class="hash-link" aria-label="Direct link to CGroups:" title="Direct link to CGroups:" href="http://joelbrs.github.io/en-US/blog/guia-introducao-docker#cgroups">​</a></h3>
<p>Para entender o funcionamento do <strong>CGroups</strong> e para quê eles servem, pensemos na seguinte ocorrência: Temos alguns containers rodando (sabendo que containers são, basicamente, processos isolados que possuem subprocessos) e, em um deles, temos um enorme vazamento (leak) de memória, o que consequentemente acaba afetando os outros processos fora desse <em>Namespace</em>. É aí que entram os CGroups. Eles surgiram para controlar e isolar os recursos de <strong>cada</strong> Namespace, para que esses recursos sejam bem distribuídos para cada um, de acordo com suas necessidades e, não só isso, para que os seus recursos não afetem o funcionamento de outros processos fora desse Namespace.</p>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="file-system--overlay-file-system-ofs">File System → Overlay File System (OFS)<a class="hash-link" aria-label="Direct link to File System → Overlay File System (OFS)" title="Direct link to File System → Overlay File System (OFS)" href="http://joelbrs.github.io/en-US/blog/guia-introducao-docker#file-system--overlay-file-system-ofs">​</a></h3>
<p>Novamente, vamos contextualizar o funcionamento do <strong>Overlay File System</strong> para uma melhor compreensão: Digamos que temos um container em que estamos rodando uma aplicação de, aproximadamente, 95mb (Megabytes), porém, para que essa aplicação funcione corretamente, é necessário a utilização de duas dependências diferentes.
A partir disso, podemos citar o seguinte possível acontecimento: surgiu a necessidade de mudar essa aplicação e, para isso, teremos que criar outra imagem a partir da que temos atualmente (falaremos sobre imagens no próximo tópico). Então, o Overlay File System (OFS) será usado para criar imagens desse novo aplicativo executável. Isso é possível porque ele pode gerar uma nova imagem a partir de uma existente, apenas alterando as partes que precisam ser atualizadas, sem a necessidade de reinstalar as dependências obrigatórias.</p>
<p>Agora que conhecemos um pouco sobre o funcionamento dos containers e de seus 3 pilares, podemos adentrar um pouco mais em outro tópicos importantes quando o assunto é Docker, bem como o conceito de <em>Imagens</em> &amp; o tão importante <em>DockerFile</em>.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="imagens">Imagens<a class="hash-link" aria-label="Direct link to Imagens" title="Direct link to Imagens" href="http://joelbrs.github.io/en-US/blog/guia-introducao-docker#imagens">​</a></h3>
<p>De forma bem objetiva, podemos definir as imagens como um “pacote” executável (ou um conjunto de dependências encadeadas) que possui todos os requisitos/dependências necessários(as) para rodar um aplicativo, incluindo, um arquivo de configuração, variáveis de ambiente, bibliotecas e assim por diante.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="dockerfile">DockerFile<a class="hash-link" aria-label="Direct link to DockerFile" title="Direct link to DockerFile" href="http://joelbrs.github.io/en-US/blog/guia-introducao-docker#dockerfile">​</a></h3>
<p>Para a <strong>criação</strong> de imagens, utilizamos o <strong>DockerFile</strong>. Basicamente, ele é um arquivo <em>declarativo</em> que cita instruções ao container Docker de como será criada e “buildada” a referente imagem que queremos criar.
De maneira usual, (quase) sempre criamos uma imagem a partir de outra imagem já existente, com suas devidas dependências pré-definidas e configuradas e vamos moldando-a de acordo com nossa necessidade.</p>
<p>Abaixo segue um exemplo de modelo de uma implementação do DockerFile, Vamos explicar linha a linha o que cada uma faz e sua respectiva função:</p>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:16.18.0-alpine as base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 3000</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>Essa primeira linha (logo abaixo) é de extrema importância, pois referencia ao DockerFile a imagem base utilizaremos para a criação da nossa.</p>
</li>
</ul>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:16.18.0-alpine as base</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Aqui, dizemos ao DockerFile que será necessário que ele rode esse comando determinado, lembrando: você pode determinar que sejam executados mais de um comando, dessa forma:</li>
</ul>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm run build</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>E, por último (não é o último comando que podemos determinar ao DockerFile e, sim o último de minha demonstração), podemos expôr portas em que essas imagens estarão rodando para que possamos acessá-las quando quisermos:</p>
</li>
</ul>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 3000</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Acredito que agora você já possui conhecimento suficiente para aprofundar-se nos estudos em Docker e, caso precise de alguma ajuda com algum conteito ou recomendação de cursos sobre o assunto, me manda solicitação no <a href="https://www.linkedin.com/in/joelbrs" target="_blank" rel="noopener noreferrer">meu LinkedIn</a>, que ficarei feliz em ajudá-lo. Além disso, espero que esse post tenha sido de muita ajuda e estarei sempre disposto a receber feedbacks!</p>]]></content>
        <author>
            <name>Joel da Silva Pereira Filho</name>
            <uri>https://github.com/joelbrs</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="devops" term="devops"/>
        <category label="beginners" term="beginners"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Idempotência: Melhorando a Resiliência de Seu Sistema - Parte I]]></title>
        <id>http://joelbrs.github.io/en-US/blog/idempotencia-parte-1</id>
        <link href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-1"/>
        <updated>2024-09-17T12:39:46.000Z</updated>
        <summary type="html"><![CDATA[À medida que seu software cresce, é crucial aplicar dois conceitos fundamentais no desenvolvimento: Resiliência e Idempotência.]]></summary>
        <content type="html"><![CDATA[<p>À medida que seu software cresce, é crucial aplicar dois conceitos fundamentais no desenvolvimento: <em>Resiliência</em> e <em>Idempotência</em>.</p>
<p>Esses conceitos trabalham juntos em harmonia. Hoje, vou apresentar uma breve introdução a esses conceitos e compartilhar como os apliquei de forma prática em meu projeto de simulação bancária, onde implementei a criação de transações entre diferentes contas de forma idempotente.</p>
<p>Confira o projeto no meu GitHub e no repositório <a href="https://github.com/joelbrs/bank.com.br" target="_blank" rel="noopener noreferrer">bank.com.br</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="resiliência">Resiliência<a class="hash-link" aria-label="Direct link to Resiliência" title="Direct link to Resiliência" href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-1#resili%C3%AAncia">​</a></h2>
<p>Resiliência é a capacidade do seu software de falhar e lidar bem com essas falhas. Para desenvolver um software resiliente, a equipe deve antecipar possíveis falhas e planejar como resolvê-las. Todos os sistemas estão sujeitos a falhas, mas o que os diferencia é a capacidade de tratar e resolver esses problemas de maneira eficiente. =)</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="idempotência">Idempotência<a class="hash-link" aria-label="Direct link to Idempotência" title="Direct link to Idempotência" href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-1#idempot%C3%AAncia">​</a></h2>
<p>Idempotência é a propriedade que algumas operações têm de poderem ser aplicadas várias vezes sem alterar o resultado após a aplicação inicial. Em outras palavras, uma operação idempotente pode ser repetida inúmeras vezes e o estado do sistema permanecerá o mesmo.</p>
<p>Por exemplo, no contexto da aplicação desenvolvida, a idempotência foi aplicada no seguinte cenário: Digamos que uma conta A está fazendo uma transação de R$10,00 para a conta B. Porém, por uma inconsistência nos servidores, essa transação foi realizada duas vezes, fazendo com que o valor enviado para a conta B dobrasse para R$20,00. Isso representa um problema significativo, especialmente em transações maiores. A idempotência pode ser aplicada para prevenir essas duplicações.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="mas-como-aplicar-esses-conceitos-na-prática">Mas como aplicar esses conceitos, na prática?<a class="hash-link" aria-label="Direct link to Mas como aplicar esses conceitos, na prática?" title="Direct link to Mas como aplicar esses conceitos, na prática?" href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-1#mas-como-aplicar-esses-conceitos-na-pr%C3%A1tica">​</a></h2>
<p>Recentemente, trabalhei em um projeto pessoal, o Bank, onde a proposta foi simular o dia-a-dia de um banco, realizando transações entre diferentes contas. As tecnologias utilizadas no projeto foram: React, Relay, GraphQL, KoaJS e MongoDB.</p>
<p>Primeiramente, criei o model utilizando o mongoose, referente às contas que seriam criadas no sistema, contendo as seguintes informações:</p>
<ul>
<li>Identificador Único da Conta</li>
<li>Número da Conta</li>
<li>O CPF/CNPJ (taxId) do usuário</li>
</ul>
<p>Em seguida, foi criado o model das transações:</p>
<ul>
<li>Identificador Único da Transação</li>
<li>O identificador da conta do remetente</li>
<li>O identificador da conta do destinatário</li>
<li>O valor a ser transferido</li>
<li>Chave de Impotência</li>
<li>Descrição da Transação (Opcional)</li>
</ul>
<p>Podemos perceber, no model de Transação, que há um campo chamado “Chave de Idempotência”. A criação e utilização desse campo no nosso banco de dados representa a estratégia de idempotência utilizada no desenvolvimento do sistema. Existem algumas estratégias para isso, como: Idempotency Key (padrão utilizado), Get Or Create, Histórico de Chamadas, dentre outros.</p>
<p>De forma geral, será gerada uma Chave de Idempotência (única) para verificar se uma transação já foi realizada anteriormente. A Chave de Idempotência deve ser única para o contexto específico de uma transação. Em uma transação, temos informações que definem seu contexto, como a conta do remetente, a conta do destinatário e o valor. Isso significa que a chave de idempotência deve ser única para uma transação que envolva essas informações. <em>Para uma discussão detalhada sobre o assunto, acesse a seguinte <a href="https://github.com/joelbrs/bank.com.br/issues/12" target="_blank" rel="noopener noreferrer">issue</a> do repositório do projeto, criada pelo <a href="https://github.com/caiocampoos" target="_blank" rel="noopener noreferrer">@caiocampoos</a></em></p>
<p>Para implementar isso, defini um índice composto no meu Schema, entre essas informações:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">TransactionSchema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> senderAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idempotentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> receiverAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> unique</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Para receber essa Chave de Idempotência, optei por recebê-la no header "idempotentkey". Essa escolha será discutida mais detalhadamente em uma publicação futura.</p>
<p>Agora, na criação da Transação, fiz a seguinte verificação:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> existingTransaction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> TransactionModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   idempotentKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   senderAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> senderAccount</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   receiverAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> receiverAccount</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existingTransaction</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     transactionId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> existingTransaction</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Observe que retorno o identificador da transação criada anteriormente com as mesmas informações, mas também poderia lançar uma exceção. Tudo depende do contexto da aplicação e de qual abordagem é a melhor para você.</p>
<p>Para criar a chave de idempotência no front-end da aplicação, escrevi o seguinte código:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> v7 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> uuid </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"uuid"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createIdempotencyKey</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> idempotencyKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sessionStorage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setItem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"idempotent-key"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idempotencyKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Armazenei a Chave de Idempotência no SessionStorage do navegador quando o usuário decide criar uma transação e, ao fazer a requisição, pego esse valor e envio no cabeçalho para o back-end. Dessa forma, garanto que essa Chave de Idempotência seja utilizada apenas naquele contexto, visto que, diferentemente do LocalStorage, esse dado só estará disponível para aquela sessão enquanto ela existir (ou até a informação ser sobrescrita).</p>
<p>Porém, pesquisando um pouco mais e refletindo melhor sobre essas ideias, conclui que essa abordagem pode ter certas limitações, que trataremos no próximo post.</p>
<p><strong>Fontes</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Idempotent" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Glossary/Idempotent</a></li>
<li><a href="https://developers.openpix.com.br/docs/concepts/idempotence" target="_blank" rel="noopener noreferrer">https://developers.openpix.com.br/docs/concepts/idempotence</a></li>
<li><a href="https://www.gooddata.com/blog/multi-tenant-architecture/" target="_blank" rel="noopener noreferrer">https://www.gooddata.com/blog/multi-tenant-architecture/</a></li>
<li><a href="https://github.com/joelbrs/bank.com.br" target="_blank" rel="noopener noreferrer">https://github.com/joelbrs/bank.com.br</a></li>
</ul>]]></content>
        <author>
            <name>Joel da Silva Pereira Filho</name>
            <uri>https://github.com/joelbrs</uri>
        </author>
        <category label="programming" term="programming"/>
        <category label="idempotency" term="idempotency"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Idempotência: Melhorando a Resiliência de Seu Sistema - Parte II]]></title>
        <id>http://joelbrs.github.io/en-US/blog/idempotencia-parte-2</id>
        <link href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-2"/>
        <updated>2024-09-17T12:46:35.000Z</updated>
        <summary type="html"><![CDATA[No post anterior, discutimos os conceitos básicos de Resiliência e Idempotência. Além disso, demonstrei como apliquei esses conceitos de forma prática em um projeto pessoal.]]></summary>
        <content type="html"><![CDATA[<p>No <a href="https://joelbrs.github.io/blog/posts/idempotencia-parte-1" target="_blank" rel="noopener noreferrer">post anterior</a>, discutimos os conceitos básicos de Resiliência e Idempotência. Além disso, demonstrei como apliquei esses conceitos de forma prática em um projeto pessoal.</p>
<p>Agora, explorarei algumas limitações do modelo inicialmente proposto e apresentarei uma alternativa viável para implementar idempotência, que é mais performática.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="quais-são-as-limitações-de-gerar-a-chave-de-idempotência-no-front-end">Quais são as limitações de gerar a Chave de Idempotência no Front-end?<a class="hash-link" aria-label="Direct link to Quais são as limitações de gerar a Chave de Idempotência no Front-end?" title="Direct link to Quais são as limitações de gerar a Chave de Idempotência no Front-end?" href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-2#quais-s%C3%A3o-as-limita%C3%A7%C3%B5es-de-gerar-a-chave-de-idempot%C3%AAncia-no-front-end">​</a></h2>
<p>No modelo proposto anteriormente, a chave de idempotência é gerada pelo front-end, armazenada no SessionStorage do navegador e posteriormente enviada ao back-end. Embora essa abordagem funcione, não é a mais adequada para resolver o problema.</p>
<p>Primeiramente, a geração da chave pelo front-end permite que o usuário do sistema a manipule, já que é facilmente acessível ao abrir a aba de armazenamento do navegador.</p>
<p>Em segundo lugar, e estritamente relacionado ao primeiro ponto, como o front-end está mais suscetível a manipulações e ataques cibernéticos. Por padrão, regras de negócio não devem ser estabelecidas no front-end. Caso haja necessidade, elas devem ser reforçadas no back-end.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="qual-seria-a-solução">Qual seria a solução?<a class="hash-link" aria-label="Direct link to Qual seria a solução?" title="Direct link to Qual seria a solução?" href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-2#qual-seria-a-solu%C3%A7%C3%A3o">​</a></h2>
<p>A primeira solução, mais simples, seria criar um endpoint no back-end para gerar a chave de idempotência e armazená-la em memória. Nesse caso, poderíamos utilizar a abordagem de gerar um UUID como chave de idempotência.</p>
<p>A segunda, mais robusta, é utilizar uma camada de cache para armazenar a chave de idempotência por um tempo pré-estabelecido. Nesse caso, a chave de idempotência poderia ser criada a partir de um hash das informações da conta do remetente, do destinatário, do valor e da descrição (se houver). Essa chave seria armazenada em um Redis, por exemplo, por 5 minutos (ou qualquer outro período de tempo, dependendo da implementação). Caso a requisição se repita devido a alguma instabilidade, a chave será buscada no cache e a transação será encontrada.</p>
<blockquote>
<p><em>Na segunda proposta, não optei por gerar um UUID a cada transação. Isso se deve ao fato de que, se um UUID for gerado a cada requisição para criar uma transação, mesmo que uma requisição seja duplicada, ainda assim seriam duas requisições diferentes, resultando em UUIDs distintos. Dessa forma, nossa chave de idempotência não seria verdadeiramente idempotente.</em></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="por-que-essa-é-uma-melhor-solução">Por que essa é uma melhor solução?<a class="hash-link" aria-label="Direct link to Por que essa é uma melhor solução?" title="Direct link to Por que essa é uma melhor solução?" href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-2#por-que-essa-%C3%A9-uma-melhor-solu%C3%A7%C3%A3o">​</a></h2>
<p>Primeiro, porque eliminamos a necessidade de um campo correspondente à chave de idempotência no banco de dados, evitando sobrecarregar o banco de dados principal com consultas para verificar se a transação já existe. A consulta ao Redis é muito mais rápida, performática e menos custosa.</p>
<p>Segundo, porque retiramos qualquer regra de negócio do front-end, evitando assim que nosso sistema esteja mais vulnerável a ataques e manipulações indesejadas dos dados.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="como-implementar-essa-solução">Como implementar essa solução?<a class="hash-link" aria-label="Direct link to Como implementar essa solução?" title="Direct link to Como implementar essa solução?" href="http://joelbrs.github.io/en-US/blog/idempotencia-parte-2#como-implementar-essa-solu%C3%A7%C3%A3o">​</a></h2>
<p>Primeiro, vamos instalar o Redis no nosso projeto NodeJS:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">pnpm add ioredis</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vamos criar uma instância do Redis:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Redis </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ioredis'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> redis </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Redis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Agora, vamos criar o hash que será nossa chave de idempotência:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> crypto </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'node:crypto'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTransaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dataToBeHashed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">senderAccount</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">receiverAccount</span><span class="token template-string interpolation operator" style="color:#393A34">?.</span><span class="token template-string interpolation">_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">value</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">description</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> idempotentKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'sha256'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataToBeHashed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">digest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'hex'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Em seguida, definimos essa chave de idempotência no cache e verificamos sua existência:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTransaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> existingTransaction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">idempotentKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'transaction'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'EX'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'GET'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existingTransaction</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Esta foi uma demonstração simples de como essa abordagem pode ser implementada com NodeJS, independentemente do framework utilizado, seja Express, NestJS, Koa ou Fastify.</p>
<p>Essa implementação ainda não está disponível no repositório do projeto, mas pretendo trabalhar nisso nos próximos dias.</p>
<p>Esta série de posts foi criada para compartilhar minha jornada no desenvolvimento deste projeto e as decisões que tomei com base em meus estudos e reflexões.</p>
<p>Estou aberto a feedbacks e novas propostas. Pretendo implementar novas features futuramente, então estou à disposição para conversar mais sobre isso no meu <a href="https://linkedin.com/in/joelbrs" target="_blank" rel="noopener noreferrer">LinkedIn</a>.</p>]]></content>
        <author>
            <name>Joel da Silva Pereira Filho</name>
            <uri>https://github.com/joelbrs</uri>
        </author>
        <category label="programming" term="programming"/>
        <category label="idempotency" term="idempotency"/>
    </entry>
</feed>