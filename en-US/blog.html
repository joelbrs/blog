<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Blog | Joel&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://joelbrs.github.io/studies/en-US/blog"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="pt_BR"><meta data-rh="true" name="docusaurus_locale" content="en-US"><meta data-rh="true" name="docsearch:language" content="en-US"><meta data-rh="true" property="og:title" content="Blog | Joel&#x27;s Blog"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/studies/en-US/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://joelbrs.github.io/studies/en-US/blog"><link data-rh="true" rel="alternate" href="http://joelbrs.github.io/studies/blog" hreflang="pt-BR"><link data-rh="true" rel="alternate" href="http://joelbrs.github.io/studies/en-US/blog" hreflang="en-US"><link data-rh="true" rel="alternate" href="http://joelbrs.github.io/studies/blog" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"http://joelbrs.github.io/studies/en-US/blog","mainEntityOfPage":"http://joelbrs.github.io/studies/en-US/blog","headline":"Blog","description":"Blog","blogPost":[{"@type":"BlogPosting","@id":"http://joelbrs.github.io/studies/en-US/blog/guia-introducao-docker","mainEntityOfPage":"http://joelbrs.github.io/studies/en-US/blog/guia-introducao-docker","url":"http://joelbrs.github.io/studies/en-US/blog/guia-introducao-docker","headline":"Guia de Introdu√ß√£o ao Docker","name":"Guia de Introdu√ß√£o ao Docker","description":"Quando falamos de Docker, uma das primeiras coisas que nos vem √† mente s√£o containers. Basicamente, quase tudo em Docker se resume a containers, ent√£o, √© super importante que voc√™ tenha esse conceito bem s√≥lido na sua mente e n√£o s√≥ isso, mas tamb√©m como funcionam.","datePublished":"2024-09-17T12:35:51.000Z","dateModified":"2024-09-17T12:39:46.000Z","author":{"@type":"Person","name":"Joel da Silva Pereira Filho","description":"Backend Developer","url":"https://github.com/joelbrs","image":"https://github.com/joelbrs.png"},"keywords":[]},{"@type":"BlogPosting","@id":"http://joelbrs.github.io/studies/en-US/blog/idempotencia-parte-1","mainEntityOfPage":"http://joelbrs.github.io/studies/en-US/blog/idempotencia-parte-1","url":"http://joelbrs.github.io/studies/en-US/blog/idempotencia-parte-1","headline":"Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte I","name":"Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte I","description":"√Ä medida que seu software cresce, √© crucial aplicar dois conceitos fundamentais no desenvolvimento: Resili√™ncia e Idempot√™ncia.","datePublished":"2024-09-17T12:39:46.000Z","dateModified":"2024-09-17T12:39:46.000Z","author":{"@type":"Person","name":"Joel da Silva Pereira Filho","description":"Backend Developer","url":"https://github.com/joelbrs","image":"https://github.com/joelbrs.png"},"keywords":[]},{"@type":"BlogPosting","@id":"http://joelbrs.github.io/studies/en-US/blog/idempotencia-parte-2","mainEntityOfPage":"http://joelbrs.github.io/studies/en-US/blog/idempotencia-parte-2","url":"http://joelbrs.github.io/studies/en-US/blog/idempotencia-parte-2","headline":"Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte II","name":"Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte II","description":"No post anterior, discutimos os conceitos b√°sicos de Resili√™ncia e Idempot√™ncia. Al√©m disso, demonstrei como apliquei esses conceitos de forma pr√°tica em um projeto pessoal.","datePublished":"2024-09-17T12:46:35.000Z","dateModified":"2024-09-17T12:46:35.000Z","author":{"@type":"Person","name":"Joel da Silva Pereira Filho","description":"Backend Developer","url":"https://github.com/joelbrs","image":"https://github.com/joelbrs.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/studies/en-US/blog/rss.xml" title="Joel&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/studies/en-US/blog/atom.xml" title="Joel&#39;s Blog Atom Feed"><link rel="stylesheet" href="/studies/en-US/assets/css/styles.d21ce918.css">
<script src="/studies/en-US/assets/js/runtime~main.1820cad5.js" defer="defer"></script>
<script src="/studies/en-US/assets/js/main.25a84a2e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_foOH" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/studies/en-US/"><div class="navbar__logo"><img src="/studies/en-US/img/logo.jpg" alt="Joel Filho" class="themedComponent_rRUu themedComponent--light_yJNY"><img src="/studies/en-US/img/logo.jpg" alt="Joel Filho" class="themedComponent_rRUu themedComponent--dark_g86C"></div><b class="navbar__title text--truncate">Joel&#x27;s Studies</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/studies/en-US/blog">Posts</a></div><div class="navbar__items navbar__items--right"><a href="https://twitter.com/joelbrs__" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">üê¶<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bob8"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">üêô<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bob8"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/joelbrs/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bob8"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_RKzC colorModeToggle_dJh5"><button class="clean-btn toggleButton_PUty toggleButtonDisabled_ywAc" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Rp4R"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_VqKD"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_nWhl"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_p4Uk"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_EGXY thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_LMbS margin-bottom--md">Todos os posts</div><ul class="sidebarItemList_jM0T clean-list"><li class="sidebarItem_AIqB"><a class="sidebarItemLink_CGCW" href="/studies/en-US/blog/guia-introducao-docker">Guia de Introdu√ß√£o ao Docker</a></li><li class="sidebarItem_AIqB"><a class="sidebarItemLink_CGCW" href="/studies/en-US/blog/idempotencia-parte-1">Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte I</a></li><li class="sidebarItem_AIqB"><a class="sidebarItemLink_CGCW" href="/studies/en-US/blog/idempotencia-parte-2">Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte II</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_SKIQ"><a href="/studies/en-US/blog/guia-introducao-docker">Guia de Introdu√ß√£o ao Docker</a></h2><div class="container_YRO2 margin-vert--md"><time datetime="2024-09-17T12:35:51.000Z">September 17, 2024</time> ¬∑ <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_fI0n"><div class="avatar margin-bottom--sm"><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/joelbrs.png" alt="Joel da Silva Pereira Filho"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer"><span>Joel da Silva Pereira Filho</span></a></div><small class="avatar__subtitle">Backend Developer</small></div></div></div></div></header><div class="markdown"><p>Quando falamos de <em>Docker</em>, uma das primeiras coisas que nos vem √† mente s√£o <em>containers</em>. Basicamente, quase tudo em Docker se resume a containers, ent√£o, √© super importante que voc√™ tenha esse conceito bem s√≥lido na sua mente e n√£o s√≥ isso, mas tamb√©m como funcionam.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="como-funcionam-os-containers">Como funcionam os containers?<a class="hash-link" aria-label="Direct link to Como funcionam os containers?" title="Direct link to Como funcionam os containers?" href="/studies/en-US/blog#como-funcionam-os-containers">‚Äã</a></h2>
<p>Para explicar o conceito de containers, podemos come√ßar pelo sistema operacional (SO) - tendo como base para a explica√ß√£o o Linux, especificamente - ser composto de processos e subprocessos. Para entender melhor esse conceito, precisamos entender os tr√™s principais pilares que os sustentam: <em>Namespaces</em>, _CGroups _e <em>Overlay File System</em> (OFS) que falaremos a seguir.</p>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="namespaces">Namespaces:<a class="hash-link" aria-label="Direct link to Namespaces:" title="Direct link to Namespaces:" href="/studies/en-US/blog#namespaces">‚Äã</a></h3>
<p>A partir desses processos, surgiu os chamados <em>Namespaces</em>, que, basicamente, atuam no <strong>isolamento</strong> de cada processo. Nesse caso, h√° uma hierarquia entre os processos-pai e os processos-filhos, onde estes √∫ltimos s√£o altamente dependentes dos primeiros e, caso aconte√ßa algo aos processos principais, todo o meu sistema operacional vai √† baixo. Tendo isso em mente, os Namespaces isolam cada processo do SO, permitindo que cada um rode de forma independente. Em outras palavras, um container emula um SO com processos rodando em isolamento e executando tarefas diferentes. Containers n√£o executam um SO completo, mas apenas os elementos espec√≠ficos necess√°rios, incluindo o kernel.</p>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="cgroups">CGroups:<a class="hash-link" aria-label="Direct link to CGroups:" title="Direct link to CGroups:" href="/studies/en-US/blog#cgroups">‚Äã</a></h3>
<p>Para entender o funcionamento do <strong>CGroups</strong> e para qu√™ eles servem, pensemos na seguinte ocorr√™ncia: Temos alguns containers rodando (sabendo que containers s√£o, basicamente, processos isolados que possuem subprocessos) e, em um deles, temos um enorme vazamento (leak) de mem√≥ria, o que consequentemente acaba afetando os outros processos fora desse <em>Namespace</em>. √â a√≠ que entram os CGroups. Eles surgiram para controlar e isolar os recursos de <strong>cada</strong> Namespace, para que esses recursos sejam bem distribu√≠dos para cada um, de acordo com suas necessidades e, n√£o s√≥ isso, para que os seus recursos n√£o afetem o funcionamento de outros processos fora desse Namespace.</p>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="file-system--overlay-file-system-ofs">File System ‚Üí Overlay File System (OFS)<a class="hash-link" aria-label="Direct link to File System ‚Üí Overlay File System (OFS)" title="Direct link to File System ‚Üí Overlay File System (OFS)" href="/studies/en-US/blog#file-system--overlay-file-system-ofs">‚Äã</a></h3>
<p>Novamente, vamos contextualizar o funcionamento do <strong>Overlay File System</strong> para uma melhor compreens√£o: Digamos que temos um container em que estamos rodando uma aplica√ß√£o de, aproximadamente, 95mb (Megabytes), por√©m, para que essa aplica√ß√£o funcione corretamente, √© necess√°rio a utiliza√ß√£o de duas depend√™ncias diferentes.
A partir disso, podemos citar o seguinte poss√≠vel acontecimento: surgiu a necessidade de mudar essa aplica√ß√£o e, para isso, teremos que criar outra imagem a partir da que temos atualmente (falaremos sobre imagens no pr√≥ximo t√≥pico). Ent√£o, o Overlay File System (OFS) ser√° usado para criar imagens desse novo aplicativo execut√°vel. Isso √© poss√≠vel porque ele pode gerar uma nova imagem a partir de uma existente, apenas alterando as partes que precisam ser atualizadas, sem a necessidade de reinstalar as depend√™ncias obrigat√≥rias.</p>
<p>Agora que conhecemos um pouco sobre o funcionamento dos containers e de seus 3 pilares, podemos adentrar um pouco mais em outro t√≥picos importantes quando o assunto √© Docker, bem como o conceito de <em>Imagens</em> &amp; o t√£o importante <em>DockerFile</em>.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="imagens">Imagens<a class="hash-link" aria-label="Direct link to Imagens" title="Direct link to Imagens" href="/studies/en-US/blog#imagens">‚Äã</a></h3>
<p>De forma bem objetiva, podemos definir as imagens como um ‚Äúpacote‚Äù execut√°vel (ou um conjunto de depend√™ncias encadeadas) que possui todos os requisitos/depend√™ncias necess√°rios(as) para rodar um aplicativo, incluindo, um arquivo de configura√ß√£o, vari√°veis de ambiente, bibliotecas e assim por diante.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_ywN1" id="dockerfile">DockerFile<a class="hash-link" aria-label="Direct link to DockerFile" title="Direct link to DockerFile" href="/studies/en-US/blog#dockerfile">‚Äã</a></h3>
<p>Para a <strong>cria√ß√£o</strong> de imagens, utilizamos o <strong>DockerFile</strong>. Basicamente, ele √© um arquivo <em>declarativo</em> que cita instru√ß√µes ao container Docker de como ser√° criada e ‚Äúbuildada‚Äù a referente imagem que queremos criar.
De maneira usual, (quase) sempre criamos uma imagem a partir de outra imagem j√° existente, com suas devidas depend√™ncias pr√©-definidas e configuradas e vamos moldando-a de acordo com nossa necessidade.</p>
<p>Abaixo segue um exemplo de modelo de uma implementa√ß√£o do DockerFile, Vamos explicar linha a linha o que cada uma faz e sua respectiva fun√ß√£o:</p>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:16.18.0-alpine as base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 3000</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>Essa primeira linha (logo abaixo) √© de extrema import√¢ncia, pois referencia ao DockerFile a imagem base utilizaremos para a cria√ß√£o da nossa.</p>
</li>
</ul>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:16.18.0-alpine as base</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Aqui, dizemos ao DockerFile que ser√° necess√°rio que ele rode esse comando determinado, lembrando: voc√™ pode determinar que sejam executados mais de um comando, dessa forma:</li>
</ul>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm run build</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>E, por √∫ltimo (n√£o √© o √∫ltimo comando que podemos determinar ao DockerFile e, sim o √∫ltimo de minha demonstra√ß√£o), podemos exp√¥r portas em que essas imagens estar√£o rodando para que possamos acess√°-las quando quisermos:</p>
</li>
</ul>
<div class="codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-text codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 3000</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Acredito que agora voc√™ j√° possui conhecimento suficiente para aprofundar-se nos estudos em Docker e, caso precise de alguma ajuda com algum conteito ou recomenda√ß√£o de cursos sobre o assunto, me manda solicita√ß√£o no <a href="https://www.linkedin.com/in/joelbrs" target="_blank" rel="noopener noreferrer">meu LinkedIn</a>, que ficarei feliz em ajud√°-lo. Al√©m disso, espero que esse post tenha sido de muita ajuda e estarei sempre disposto a receber feedbacks!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_FjBe padding--none margin-left--sm"><li class="tag_WlVj"><a class="tag_GIYv tagRegular_qUvn" href="/studies/en-US/blog/tags/docker">docker</a></li><li class="tag_WlVj"><a class="tag_GIYv tagRegular_qUvn" href="/studies/en-US/blog/tags/devops">devops</a></li><li class="tag_WlVj"><a class="tag_GIYv tagRegular_qUvn" href="/studies/en-US/blog/tags/beginners">beginners</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_SKIQ"><a href="/studies/en-US/blog/idempotencia-parte-1">Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte I</a></h2><div class="container_YRO2 margin-vert--md"><time datetime="2024-09-17T12:39:46.000Z">September 17, 2024</time> ¬∑ <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_fI0n"><div class="avatar margin-bottom--sm"><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/joelbrs.png" alt="Joel da Silva Pereira Filho"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer"><span>Joel da Silva Pereira Filho</span></a></div><small class="avatar__subtitle">Backend Developer</small></div></div></div></div></header><div class="markdown"><p>√Ä medida que seu software cresce, √© crucial aplicar dois conceitos fundamentais no desenvolvimento: <em>Resili√™ncia</em> e <em>Idempot√™ncia</em>.</p>
<p>Esses conceitos trabalham juntos em harmonia. Hoje, vou apresentar uma breve introdu√ß√£o a esses conceitos e compartilhar como os apliquei de forma pr√°tica em meu projeto de simula√ß√£o banc√°ria, onde implementei a cria√ß√£o de transa√ß√µes entre diferentes contas de forma idempotente.</p>
<p>Confira o projeto no meu GitHub e no reposit√≥rio <a href="https://github.com/joelbrs/bank.com.br" target="_blank" rel="noopener noreferrer">bank.com.br</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="resili√™ncia">Resili√™ncia<a class="hash-link" aria-label="Direct link to Resili√™ncia" title="Direct link to Resili√™ncia" href="/studies/en-US/blog#resili√™ncia">‚Äã</a></h2>
<p>Resili√™ncia √© a capacidade do seu software de falhar e lidar bem com essas falhas. Para desenvolver um software resiliente, a equipe deve antecipar poss√≠veis falhas e planejar como resolv√™-las. Todos os sistemas est√£o sujeitos a falhas, mas o que os diferencia √© a capacidade de tratar e resolver esses problemas de maneira eficiente. =)</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="idempot√™ncia">Idempot√™ncia<a class="hash-link" aria-label="Direct link to Idempot√™ncia" title="Direct link to Idempot√™ncia" href="/studies/en-US/blog#idempot√™ncia">‚Äã</a></h2>
<p>Idempot√™ncia √© a propriedade que algumas opera√ß√µes t√™m de poderem ser aplicadas v√°rias vezes sem alterar o resultado ap√≥s a aplica√ß√£o inicial. Em outras palavras, uma opera√ß√£o idempotente pode ser repetida in√∫meras vezes e o estado do sistema permanecer√° o mesmo.</p>
<p>Por exemplo, no contexto da aplica√ß√£o desenvolvida, a idempot√™ncia foi aplicada no seguinte cen√°rio: Digamos que uma conta A est√° fazendo uma transa√ß√£o de R$10,00 para a conta B. Por√©m, por uma inconsist√™ncia nos servidores, essa transa√ß√£o foi realizada duas vezes, fazendo com que o valor enviado para a conta B dobrasse para R$20,00. Isso representa um problema significativo, especialmente em transa√ß√µes maiores. A idempot√™ncia pode ser aplicada para prevenir essas duplica√ß√µes.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="mas-como-aplicar-esses-conceitos-na-pr√°tica">Mas como aplicar esses conceitos, na pr√°tica?<a class="hash-link" aria-label="Direct link to Mas como aplicar esses conceitos, na pr√°tica?" title="Direct link to Mas como aplicar esses conceitos, na pr√°tica?" href="/studies/en-US/blog#mas-como-aplicar-esses-conceitos-na-pr√°tica">‚Äã</a></h2>
<p>Recentemente, trabalhei em um projeto pessoal, o Bank, onde a proposta foi simular o dia-a-dia de um banco, realizando transa√ß√µes entre diferentes contas. As tecnologias utilizadas no projeto foram: React, Relay, GraphQL, KoaJS e MongoDB.</p>
<p>Primeiramente, criei o model utilizando o mongoose, referente √†s contas que seriam criadas no sistema, contendo as seguintes informa√ß√µes:</p>
<ul>
<li>Identificador √önico da Conta</li>
<li>N√∫mero da Conta</li>
<li>O CPF/CNPJ (taxId) do usu√°rio</li>
</ul>
<p>Em seguida, foi criado o model das transa√ß√µes:</p>
<ul>
<li>Identificador √önico da Transa√ß√£o</li>
<li>O identificador da conta do remetente</li>
<li>O identificador da conta do destinat√°rio</li>
<li>O valor a ser transferido</li>
<li>Chave de Impot√™ncia</li>
<li>Descri√ß√£o da Transa√ß√£o (Opcional)</li>
</ul>
<p>Podemos perceber, no model de Transa√ß√£o, que h√° um campo chamado ‚ÄúChave de Idempot√™ncia‚Äù. A cria√ß√£o e utiliza√ß√£o desse campo no nosso banco de dados representa a estrat√©gia de idempot√™ncia utilizada no desenvolvimento do sistema. Existem algumas estrat√©gias para isso, como: Idempotency Key (padr√£o utilizado), Get Or Create, Hist√≥rico de Chamadas, dentre outros.</p>
<p>De forma geral, ser√° gerada uma Chave de Idempot√™ncia (√∫nica) para verificar se uma transa√ß√£o j√° foi realizada anteriormente. A Chave de Idempot√™ncia deve ser √∫nica para o contexto espec√≠fico de uma transa√ß√£o. Em uma transa√ß√£o, temos informa√ß√µes que definem seu contexto, como a conta do remetente, a conta do destinat√°rio e o valor. Isso significa que a chave de idempot√™ncia deve ser √∫nica para uma transa√ß√£o que envolva essas informa√ß√µes. <em>Para uma discuss√£o detalhada sobre o assunto, acesse a seguinte <a href="https://github.com/joelbrs/bank.com.br/issues/12" target="_blank" rel="noopener noreferrer">issue</a> do reposit√≥rio do projeto, criada pelo <a href="https://github.com/caiocampoos" target="_blank" rel="noopener noreferrer">@caiocampoos</a></em></p>
<p>Para implementar isso, defini um √≠ndice composto no meu Schema, entre essas informa√ß√µes:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">TransactionSchema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> senderAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idempotentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> receiverAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> unique</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Para receber essa Chave de Idempot√™ncia, optei por receb√™-la no header &quot;idempotentkey&quot;. Essa escolha ser√° discutida mais detalhadamente em uma publica√ß√£o futura.</p>
<p>Agora, na cria√ß√£o da Transa√ß√£o, fiz a seguinte verifica√ß√£o:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> existingTransaction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> TransactionModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   idempotentKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   senderAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> senderAccount</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   receiverAccountId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> receiverAccount</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existingTransaction</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     transactionId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> existingTransaction</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Observe que retorno o identificador da transa√ß√£o criada anteriormente com as mesmas informa√ß√µes, mas tamb√©m poderia lan√ßar uma exce√ß√£o. Tudo depende do contexto da aplica√ß√£o e de qual abordagem √© a melhor para voc√™.</p>
<p>Para criar a chave de idempot√™ncia no front-end da aplica√ß√£o, escrevi o seguinte c√≥digo:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> v7 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> uuid </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;uuid&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createIdempotencyKey</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> idempotencyKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sessionStorage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setItem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;idempotent-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idempotencyKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Armazenei a Chave de Idempot√™ncia no SessionStorage do navegador quando o usu√°rio decide criar uma transa√ß√£o e, ao fazer a requisi√ß√£o, pego esse valor e envio no cabe√ßalho para o back-end. Dessa forma, garanto que essa Chave de Idempot√™ncia seja utilizada apenas naquele contexto, visto que, diferentemente do LocalStorage, esse dado s√≥ estar√° dispon√≠vel para aquela sess√£o enquanto ela existir (ou at√© a informa√ß√£o ser sobrescrita).</p>
<p>Por√©m, pesquisando um pouco mais e refletindo melhor sobre essas ideias, conclui que essa abordagem pode ter certas limita√ß√µes, que trataremos no pr√≥ximo post.</p>
<p><strong>Fontes</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Idempotent" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Glossary/Idempotent</a></li>
<li><a href="https://developers.openpix.com.br/docs/concepts/idempotence" target="_blank" rel="noopener noreferrer">https://developers.openpix.com.br/docs/concepts/idempotence</a></li>
<li><a href="https://www.gooddata.com/blog/multi-tenant-architecture/" target="_blank" rel="noopener noreferrer">https://www.gooddata.com/blog/multi-tenant-architecture/</a></li>
<li><a href="https://github.com/joelbrs/bank.com.br" target="_blank" rel="noopener noreferrer">https://github.com/joelbrs/bank.com.br</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_FjBe padding--none margin-left--sm"><li class="tag_WlVj"><a class="tag_GIYv tagRegular_qUvn" href="/studies/en-US/blog/tags/programming">programming</a></li><li class="tag_WlVj"><a class="tag_GIYv tagRegular_qUvn" href="/studies/en-US/blog/tags/idempotency">idempotency</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_SKIQ"><a href="/studies/en-US/blog/idempotencia-parte-2">Idempot√™ncia: Melhorando a Resili√™ncia de Seu Sistema - Parte II</a></h2><div class="container_YRO2 margin-vert--md"><time datetime="2024-09-17T12:46:35.000Z">September 17, 2024</time> ¬∑ <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_fI0n"><div class="avatar margin-bottom--sm"><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/joelbrs.png" alt="Joel da Silva Pereira Filho"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer"><span>Joel da Silva Pereira Filho</span></a></div><small class="avatar__subtitle">Backend Developer</small></div></div></div></div></header><div class="markdown"><p>No <a href="https://joelbrs.github.io/blog/posts/idempotencia-parte-1" target="_blank" rel="noopener noreferrer">post anterior</a>, discutimos os conceitos b√°sicos de Resili√™ncia e Idempot√™ncia. Al√©m disso, demonstrei como apliquei esses conceitos de forma pr√°tica em um projeto pessoal.</p>
<p>Agora, explorarei algumas limita√ß√µes do modelo inicialmente proposto e apresentarei uma alternativa vi√°vel para implementar idempot√™ncia, que √© mais perform√°tica.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="quais-s√£o-as-limita√ß√µes-de-gerar-a-chave-de-idempot√™ncia-no-front-end">Quais s√£o as limita√ß√µes de gerar a Chave de Idempot√™ncia no Front-end?<a class="hash-link" aria-label="Direct link to Quais s√£o as limita√ß√µes de gerar a Chave de Idempot√™ncia no Front-end?" title="Direct link to Quais s√£o as limita√ß√µes de gerar a Chave de Idempot√™ncia no Front-end?" href="/studies/en-US/blog#quais-s√£o-as-limita√ß√µes-de-gerar-a-chave-de-idempot√™ncia-no-front-end">‚Äã</a></h2>
<p>No modelo proposto anteriormente, a chave de idempot√™ncia √© gerada pelo front-end, armazenada no SessionStorage do navegador e posteriormente enviada ao back-end. Embora essa abordagem funcione, n√£o √© a mais adequada para resolver o problema.</p>
<p>Primeiramente, a gera√ß√£o da chave pelo front-end permite que o usu√°rio do sistema a manipule, j√° que √© facilmente acess√≠vel ao abrir a aba de armazenamento do navegador.</p>
<p>Em segundo lugar, e estritamente relacionado ao primeiro ponto, como o front-end est√° mais suscet√≠vel a manipula√ß√µes e ataques cibern√©ticos. Por padr√£o, regras de neg√≥cio n√£o devem ser estabelecidas no front-end. Caso haja necessidade, elas devem ser refor√ßadas no back-end.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="qual-seria-a-solu√ß√£o">Qual seria a solu√ß√£o?<a class="hash-link" aria-label="Direct link to Qual seria a solu√ß√£o?" title="Direct link to Qual seria a solu√ß√£o?" href="/studies/en-US/blog#qual-seria-a-solu√ß√£o">‚Äã</a></h2>
<p>A primeira solu√ß√£o, mais simples, seria criar um endpoint no back-end para gerar a chave de idempot√™ncia e armazen√°-la em mem√≥ria. Nesse caso, poder√≠amos utilizar a abordagem de gerar um UUID como chave de idempot√™ncia.</p>
<p>A segunda, mais robusta, √© utilizar uma camada de cache para armazenar a chave de idempot√™ncia por um tempo pr√©-estabelecido. Nesse caso, a chave de idempot√™ncia poderia ser criada a partir de um hash das informa√ß√µes da conta do remetente, do destinat√°rio, do valor e da descri√ß√£o (se houver). Essa chave seria armazenada em um Redis, por exemplo, por 5 minutos (ou qualquer outro per√≠odo de tempo, dependendo da implementa√ß√£o). Caso a requisi√ß√£o se repita devido a alguma instabilidade, a chave ser√° buscada no cache e a transa√ß√£o ser√° encontrada.</p>
<blockquote>
<p><em>Na segunda proposta, n√£o optei por gerar um UUID a cada transa√ß√£o. Isso se deve ao fato de que, se um UUID for gerado a cada requisi√ß√£o para criar uma transa√ß√£o, mesmo que uma requisi√ß√£o seja duplicada, ainda assim seriam duas requisi√ß√µes diferentes, resultando em UUIDs distintos. Dessa forma, nossa chave de idempot√™ncia n√£o seria verdadeiramente idempotente.</em></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="por-que-essa-√©-uma-melhor-solu√ß√£o">Por que essa √© uma melhor solu√ß√£o?<a class="hash-link" aria-label="Direct link to Por que essa √© uma melhor solu√ß√£o?" title="Direct link to Por que essa √© uma melhor solu√ß√£o?" href="/studies/en-US/blog#por-que-essa-√©-uma-melhor-solu√ß√£o">‚Äã</a></h2>
<p>Primeiro, porque eliminamos a necessidade de um campo correspondente √† chave de idempot√™ncia no banco de dados, evitando sobrecarregar o banco de dados principal com consultas para verificar se a transa√ß√£o j√° existe. A consulta ao Redis √© muito mais r√°pida, perform√°tica e menos custosa.</p>
<p>Segundo, porque retiramos qualquer regra de neg√≥cio do front-end, evitando assim que nosso sistema esteja mais vulner√°vel a ataques e manipula√ß√µes indesejadas dos dados.</p>
<h2 class="anchor anchorWithStickyNavbar_ywN1" id="como-implementar-essa-solu√ß√£o">Como implementar essa solu√ß√£o?<a class="hash-link" aria-label="Direct link to Como implementar essa solu√ß√£o?" title="Direct link to Como implementar essa solu√ß√£o?" href="/studies/en-US/blog#como-implementar-essa-solu√ß√£o">‚Äã</a></h2>
<p>Primeiro, vamos instalar o Redis no nosso projeto NodeJS:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token plain">pnpm add ioredis</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vamos criar uma inst√¢ncia do Redis:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Redis </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ioredis&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> redis </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Redis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Agora, vamos criar o hash que ser√° nossa chave de idempot√™ncia:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> crypto </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;node:crypto&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTransaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dataToBeHashed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">senderAccount</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">receiverAccount</span><span class="token template-string interpolation operator" style="color:#393A34">?.</span><span class="token template-string interpolation">_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">value</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">description</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> idempotentKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;sha256&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataToBeHashed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">digest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;hex&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Em seguida, definimos essa chave de idempot√™ncia no cache e verificamos sua exist√™ncia:</p>
<div class="language-ts codeBlockContainer_X4I_ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Z5Yf"><pre tabindex="0" class="prism-code language-ts codeBlock_RqMe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_szST"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTransaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> existingTransaction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">idempotentKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;transaction&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;EX&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GET&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existingTransaction</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_GSZl"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_p3xI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_F2so"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_qezl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Esta foi uma demonstra√ß√£o simples de como essa abordagem pode ser implementada com NodeJS, independentemente do framework utilizado, seja Express, NestJS, Koa ou Fastify.</p>
<p>Essa implementa√ß√£o ainda n√£o est√° dispon√≠vel no reposit√≥rio do projeto, mas pretendo trabalhar nisso nos pr√≥ximos dias.</p>
<p>Esta s√©rie de posts foi criada para compartilhar minha jornada no desenvolvimento deste projeto e as decis√µes que tomei com base em meus estudos e reflex√µes.</p>
<p>Estou aberto a feedbacks e novas propostas. Pretendo implementar novas features futuramente, ent√£o estou √† disposi√ß√£o para conversar mais sobre isso no meu <a href="https://linkedin.com/in/joelbrs" target="_blank" rel="noopener noreferrer">LinkedIn</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_FjBe padding--none margin-left--sm"><li class="tag_WlVj"><a class="tag_GIYv tagRegular_qUvn" href="/studies/en-US/blog/tags/programming">programming</a></li><li class="tag_WlVj"><a class="tag_GIYv tagRegular_qUvn" href="/studies/en-US/blog/tags/idempotency">idempotency</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Comunidades</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://linkedin.com/in/joelbrs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bob8"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/joelbrs__" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bob8"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Outros</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/joelbrs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bob8"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2024 Joel's Blog, Inc.</div></div></div></footer></div>
</body>
</html>